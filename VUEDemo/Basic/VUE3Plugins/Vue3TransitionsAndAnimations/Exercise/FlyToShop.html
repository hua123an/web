<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fly to shop</title>
  <script src="/VUEDemo/Package/vue.global.js"></script>
  <link rel="stylesheet" href="FlyToShop.css">
</head>
<body>
<div id="app">
  <ul class="shop">
  <li v-for="item in items">
    <span>{{item.text}}</span>
    <span>{{item.price}}</span>
    <button @click="addItem">添加</button>
  </li>
  </ul>
</div>
<div class="cart">{{count}}</div>
<div class="ball-container">
  <transition name="drop" @before-enter="beforeDrop" @enter="drop" @after-enter="afterDrop" >
    <div class="ball" v-show="ball.show">
      <div class="inner inner-hook"></div>
    </div>
  </transition>
</div>
<script>
  const app = Vue.createApp({
    data(){
      return {
        count : 0,
        items : [{
          text : '蛋炒饭',
          price : 15
        },
          {
            text : '拉面',
            price : 20
          }],
        balls : [
                {show : false},
          {show : false},
          {show : false}
        ],
        dropBalls :[],
      }
    },
    beforeDrop(el){
      let count = this.balls.length
      while(count --){
        let ball = this.balls[count]
        if (ball.show){
          let rect = ball.el.getBoundingClientRect()
          let x = rect.left - 32
          let y = -(window.innerHeight - rect.top - 22)
          el.style.display = ''
          el.style.webkitTransform = "translateY('+ y  + ‘px)"
          el.style.transform = "translateY(' + y + 'px)"
          let inner = el.getElementsByClassName('inner-hook')[0]
          inner.style.webkitTransform = "translateX('+ x + 'px)"
          inner.style.transform = "translateX('+ x + 'px)"
          }
        }
      },
    drop(el , done){
      let rf = el.offsetHeight;
      el.style.webkitTransform = 'translate3d( 0 , 0 , 0)'
      el.style.transform = 'translate3d( 0 , 0 , 0)'
      let inner = el.getElementsByClassName('inner-hook')[0]
      inner.style.webkitTransform  = 'translate3d(0 , 0 , 0)'
      inner.style.transform = 'translate3d(0 , 0 , 0)'
      el.addEventListener('transitioned' , done)
    },
    afterDrop(el) {
      let ball = this.dropBalls.shift()
      if (ball) {
        ball.show = false
        el.style.display = 'none'
      }
    },
    method : {
      addItem(event){
        this.drop(event.target)
        this.count++
      },
      drop(el) {
        for (let i = 0 ; i <this.balls.length ; i++ ) {
          let ball = this.balls[i]
          if (!ball.show) {
            ball.show = true
            ball.el = el
            this.dropBalls.push(ball)
            return
          }
        }

      }
    }
})
const vm = Vue.mount('#app')
</script>
</body>
</html>